(()=>{"use strict";var e={840:e=>{e.exports=require("electron")},478:e=>{e.exports=require("electron-context-menu")},913:e=>{e.exports=require("electron-debug")},60:e=>{e.exports=require("vue-devtools")},17:e=>{e.exports=require("path")}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{a.r(s);var e=a(840),t=a(17),i=a.n(t);const o=require("child_process");var r=a.n(o);const n="sync-history",l="sync-profiles",d="sync-playlists",c="db-action-create",p="db-action-find",u="db-action-upsert",y="db-action-delete",h="db-action-delete-multiple",w="db-action-delete-all",m="db-action-persist",f="db-action-history-update-watch-progress",g="db-action-playlists-upsert-video-by-playlist-name",v="db-action-playlists-upsert-video-ids-by-playlist-id",b="db-action-playlists-delete-video-by-playlist-name",S="db-action-playlists-delete-video-ids",_="db-action-playlists-delete-all-videos",C="sync-create",x="sync-upsert",P="sync-delete",M="sync-delete-all",B="sync-history-update-watch-progress",k="sync-playlists-upsert-video",I="sync-playlists-delete-video",W=require("nedb-promises");var N,A,O=a.n(W);let $=null;if(null!==(N=process)&&void 0!==N&&null!==(A=N.versions)&&void 0!==A&&A.electron){const{app:e}=a(840),{join:t}=a(17),s=e.getPath("userData");$=e=>t(s,`${e}.db`)}else $=e=>`${e}.db`;const D={};D.settings=O().create({filename:$("settings"),autoload:!0}),D.profiles=O().create({filename:$("profiles"),autoload:!0}),D.playlists=O().create({filename:$("playlists"),autoload:!0}),D.history=O().create({filename:$("history"),autoload:!0});const T=D,E={settings:class{static find(){return T.settings.find({_id:{$ne:"bounds"}})}static upsert(e,t){return T.settings.update({_id:e},{_id:e,value:t},{upsert:!0})}static _findAppReadyRelatedSettings(){return T.settings.find({$or:[{_id:"disableSmoothScrolling"},{_id:"useProxy"},{_id:"proxyProtocol"},{_id:"proxyHostname"},{_id:"proxyPort"}]})}static _findBounds(){return T.settings.findOne({_id:"bounds"})}static _findTheme(){return T.settings.findOne({_id:"baseTheme"})}static _updateBounds(e){return T.settings.update({_id:"bounds"},{_id:"bounds",value:e},{upsert:!0})}},history:class{static find(){return T.history.find({}).sort({timeWatched:-1})}static upsert(e){return T.history.update({videoId:e.videoId},e,{upsert:!0})}static updateWatchProgress(e,t){return T.history.update({videoId:e},{$set:{watchProgress:t}},{upsert:!0})}static delete(e){return T.history.remove({videoId:e})}static deleteAll(){return T.history.remove({},{multi:!0})}static persist(){T.history.persistence.compactDatafile()}},profiles:class{static create(e){return T.profiles.insert(e)}static find(){return T.profiles.find({})}static upsert(e){return T.profiles.update({_id:e._id},e,{upsert:!0})}static delete(e){return T.profiles.remove({_id:e})}static persist(){T.profiles.persistence.compactDatafile()}},playlists:class{static create(e){return T.playlists.insert(e)}static find(){return T.playlists.find({})}static upsertVideoByPlaylistName(e,t){return T.playlists.update({playlistName:e},{$push:{videos:t}},{upsert:!0})}static upsertVideoIdsByPlaylistId(e,t){return T.playlists.update({_id:e},{$push:{videos:{$each:t}}},{upsert:!0})}static delete(e){return T.playlists.remove({_id:e,protected:{$ne:!0}})}static deleteVideoIdByPlaylistName(e,t){return T.playlists.update({playlistName:e},{$pull:{videos:{videoId:t}}},{upsert:!0})}static deleteVideoIdsByPlaylistName(e,t){return T.playlists.update({playlistName:e},{$pull:{videos:{$in:t}}},{upsert:!0})}static deleteAllVideosByPlaylistName(e){return T.playlists.update({playlistName:e},{$set:{videos:[]}},{upsert:!0})}static deleteMultiple(e){return T.playlists.remove({_id:{$in:e},protected:{$ne:!0}})}static deleteAll(){return T.playlists.remove({protected:{$ne:!0}})}}};process.argv.includes("--version")?(console.log(`v${e.app.getVersion()}`),e.app.exit()):function(){a(478)({showSearchWithGoogle:!1,showSaveImageAs:!0,showCopyImageAddress:!0,prepend:(e,t,a)=>[{label:"Show Video Statistics",visible:"video"===t.mediaType,click:()=>{a.webContents.send("showVideoStatistics")}}]}),process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";const t=process.argv.includes("--debug");let s,o;async function W({replaceMainWindow:t=!0,windowStartupUrl:a=null,showWindowNow:o=!1}={}){const r={backgroundColor:await E.settings._findTheme().then((({value:t})=>{switch(t){case"dark":return"#212121";case"light":return"#f1f1f1";case"black":return"#000000";case"dracula":return"#282a36";case"catppuccin-mocha":return"#1e1e2e";default:return e.nativeTheme.shouldUseDarkColors?"#212121":"#f1f1f1"}})).catch((t=>(console.log(t),e.nativeTheme.shouldUseDarkColors?"#212121":"#f1f1f1"))),darkTheme:e.nativeTheme.shouldUseDarkColors,icon:`${__dirname}/_icons/iconColor.png`,autoHideMenuBar:!0,webPreferences:{nodeIntegration:!0,nodeIntegrationInWorker:!1,webSecurity:!1,backgroundThrottling:!1,contextIsolation:!1}},n=new e.BrowserWindow(Object.assign({show:o},r));n.webContents.setWindowOpenHandler((e=>(W({replaceMainWindow:!1,showWindowNow:!0,windowStartupUrl:e.url}),{action:"deny"}))),t&&(s=n),n.setBounds({width:1200,height:800});const l=await E.settings._findBounds();if("object"==typeof(null==l?void 0:l.value)){const{maximized:t,...a}=l.value;e.screen.getAllDisplays().reduce(((e,{size:{width:t}})=>e+t),0)>=a.x&&n.setBounds({x:a.x,y:a.y,width:a.width,height:a.height}),t&&n.maximize()}t&&function(){const t=[{label:"File",submenu:[{label:"New Window",accelerator:"CmdOrCtrl+N",click:(e,t,a)=>{W({replaceMainWindow:!1,showWindowNow:!0})},type:"normal"},{type:"separator"},{role:"quit"}]},{label:"Edit",submenu:[{role:"cut"},{role:"copy",accelerator:"CmdOrCtrl+C",selector:"copy:"},{role:"paste",accelerator:"CmdOrCtrl+V",selector:"paste:"},{role:"pasteandmatchstyle"},{role:"delete"},{role:"selectall"}]},{label:"View",submenu:[{role:"reload"},{role:"forcereload",accelerator:"CmdOrCtrl+Shift+R"},{role:"toggledevtools"},{type:"separator"},{role:"resetzoom"},{role:"resetzoom",accelerator:"CmdOrCtrl+num0",visible:!1},{role:"zoomin",accelerator:"CmdOrCtrl+Plus"},{role:"zoomin",accelerator:"CmdOrCtrl+=",visible:!1},{role:"zoomin",accelerator:"CmdOrCtrl+numadd",visible:!1},{role:"zoomout"},{role:"zoomout",accelerator:"CmdOrCtrl+numsub",visible:!1},{type:"separator"},{role:"togglefullscreen"}]},{role:"window",submenu:[{role:"minimize"},{role:"close"}]}];"darwin"===process.platform&&(t.unshift({label:e.app.getName(),submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideothers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}),t.push({role:"window"},{role:"help"},{role:"services"}));const a=e.Menu.buildFromTemplate(t);e.Menu.setApplicationMenu(a)}(),null!=a?n.loadURL(a):n.loadFile(`${__dirname}/index.html`),global.__static=i().join(__dirname,"/static").replace(/\\/g,"\\\\"),n.once("ready-to-show",(()=>{n.isVisible()||(n.show(),n.focus())})),n.once("close",(async()=>{if(1!==e.BrowserWindow.getAllWindows().length)return;const t={...n.getNormalBounds(),maximized:n.isMaximized()};await E.settings._updateBounds(t)})),n.once("closed",(()=>{const t=e.BrowserWindow.getAllWindows();0!==t.length&&n===s&&(s=t[0]),console.log("closed")}))}function N(t,a,s){const i=e.BrowserWindow.getAllWindows().filter((e=>e.webContents.id!==a.sender.id));for(const e of i)e.webContents.send(t,s)}e.app.commandLine.appendSwitch("disable-features","OutOfBlinkCors"),e.app.commandLine.appendSwitch("enable-accelerated-video-decode"),e.app.commandLine.appendSwitch("enable-file-cookies"),e.app.commandLine.appendSwitch("ignore-gpu-blacklist"),e.app.removeAsDefaultProtocolClient("freetube"),e.app.setAsDefaultProtocolClient("freetube"),e.app.requestSingleInstanceLock()||e.app.quit(),e.app.on("second-instance",((e,t,a)=>{if(s&&void 0!==t){s.isMinimized()&&s.restore(),s.focus();const e=$(t);e&&s.webContents.send("openUrl",e)}})),e.app.on("ready",(async(a,i)=>{var o;let r;try{r=await E.settings._findAppReadyRelatedSettings()}catch(t){return console.error(t),void e.app.exit()}let n=!1,l=!1,d="socks5",c="127.0.0.1",p="9050";(null===(o=r)||void 0===o?void 0:o.length)>0&&r.forEach((e=>{switch(e._id){case"disableSmoothScrolling":n=e.value;break;case"useProxy":l=e.value;break;case"proxyProtocol":d=e.value;break;case"proxyHostname":c=e.value;break;case"proxyPort":p=e.value}})),n?e.app.commandLine.appendSwitch("disable-smooth-scrolling"):e.app.commandLine.appendSwitch("enable-smooth-scrolling"),l&&e.session.defaultSession.setProxy({proxyRules:`${d}://${c}:${p}`}),["http://www.youtube.com","https://www.youtube.com","http://youtube.com","https://youtube.com"].forEach((t=>{e.session.defaultSession.cookies.set({url:t,name:"CONSENT",value:"YES+",sameSite:"no_restriction"})})),await W(),t&&s.webContents.openDevTools()})),e.ipcMain.once("appReady",(()=>{o&&s.webContents.send("openUrl",o)})),e.ipcMain.once("relaunchRequest",(()=>{const{env:{APPIMAGE:t,PORTABLE_EXECUTABLE_FILE:a}}=process;t?r().spawn(t,{detached:!0,stdio:"ignore"}).unref():e.app.relaunch({args:process.argv.slice(1),execPath:a||process.execPath}),e.app.quit()})),e.nativeTheme.on("updated",(()=>{e.BrowserWindow.getAllWindows().forEach((t=>{t.webContents.send("native-theme-update",e.nativeTheme.shouldUseDarkColors)}))})),e.ipcMain.on("enable-proxy",((t,a)=>{console.log(a),e.session.defaultSession.setProxy({proxyRules:a})})),e.ipcMain.on("disable-proxy",(()=>{e.session.defaultSession.setProxy({})})),e.ipcMain.on("open-external-link",((t,a)=>{"string"==typeof a&&e.shell.openExternal(a)})),e.ipcMain.handle("get-system-locale",(()=>e.app.getLocale())),e.ipcMain.handle("get-user-data-path",(()=>e.app.getPath("userData"))),e.ipcMain.on("get-user-data-path-sync",(t=>{t.returnValue=e.app.getPath("userData")})),e.ipcMain.handle("get-pictures-path",(()=>e.app.getPath("pictures"))),e.ipcMain.handle("show-open-dialog",(async(t,a)=>await e.dialog.showOpenDialog(a))),e.ipcMain.handle("show-save-dialog",(async(t,{options:a,useModal:s})=>{if(s){const s=e.BrowserWindow.getAllWindows().find((e=>e.webContents.id===t.sender.id));if(s)return await e.dialog.showSaveDialog(s,a)}return await e.dialog.showSaveDialog(a)})),e.ipcMain.on("stop-power-save-blocker",((t,a)=>{e.powerSaveBlocker.stop(a)})),e.ipcMain.handle("start-power-save-blocker",(t=>e.powerSaveBlocker.start("prevent-display-sleep"))),e.ipcMain.on("create-new-window",((e,{windowStartupUrl:t=null}={})=>{W({replaceMainWindow:!1,showWindowNow:!0,windowStartupUrl:t})})),e.ipcMain.on("open-in-external-player",((e,t)=>{r().spawn(t.executable,t.args,{detached:!0,stdio:"ignore"}).unref()})),e.ipcMain.handle("db-settings",(async(e,{action:t,data:a})=>{try{switch(t){case p:return await E.settings.find();case u:return await E.settings.upsert(a._id,a.value),N("sync-settings",e,{event:x,data:a}),null;default:throw"invalid settings db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-history",(async(e,{action:t,data:a})=>{try{switch(t){case p:return await E.history.find();case u:return await E.history.upsert(a),N(n,e,{event:x,data:a}),null;case f:return await E.history.updateWatchProgress(a.videoId,a.watchProgress),N(n,e,{event:B,data:a}),null;case y:return await E.history.delete(a),N(n,e,{event:P,data:a}),null;case w:return await E.history.deleteAll(),N(n,e,{event:M}),null;case m:return E.history.persist(),null;default:throw"invalid history db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-profiles",(async(e,{action:t,data:a})=>{try{switch(t){case c:{const t=await E.profiles.create(a);return N(l,e,{event:C,data:t}),t}case p:return await E.profiles.find();case u:return await E.profiles.upsert(a),N(l,e,{event:x,data:a}),null;case y:return await E.profiles.delete(a),N(l,e,{event:P,data:a}),null;case m:return E.profiles.persist(),null;default:throw"invalid profile db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-playlists",(async(e,{action:t,data:a})=>{try{switch(t){case c:return await E.playlists.create(a),null;case p:return await E.playlists.find();case g:return await E.playlists.upsertVideoByPlaylistName(a.playlistName,a.videoData),N(d,e,{event:k,data:a}),null;case v:return await E.playlists.upsertVideoIdsByPlaylistId(a._id,a.videoIds),null;case y:return await E.playlists.delete(a),null;case b:return await E.playlists.deleteVideoIdByPlaylistName(a.playlistName,a.videoId),N(d,e,{event:I,data:a}),null;case S:return await E.playlists.deleteVideoIdsByPlaylistName(a.playlistName,a.videoIds),null;case _:return await E.playlists.deleteAllVideosByPlaylistName(a),null;case h:return await E.playlists.deleteMultiple(a),null;case w:return await E.playlists.deleteAll(),null;default:throw"invalid playlist db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.app.once("window-all-closed",(()=>{e.session.defaultSession.clearCache(),e.session.defaultSession.clearStorageData({storages:["appcache","cookies","filesystem","indexdb","shadercache","websql","serviceworkers","cachestorage"]}),"darwin"!==process.platform&&e.app.quit()})),e.app.on("activate",(()=>{0===e.BrowserWindow.getAllWindows().length&&W()})),e.app.on("open-url",((e,t)=>{e.preventDefault(),s&&s.webContents?s.webContents.send("openUrl",O(t)):o=O(t)}));const A=$(process.argv);function O(e){return e.replace("freetube://","")}function $(e){return e.length>1?O(e[e.length-1]):null}A&&(o=A)}()})(),module.exports=s})();