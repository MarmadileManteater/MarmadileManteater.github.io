(()=>{"use strict";var e={840:e=>{e.exports=require("electron")},478:e=>{e.exports=require("electron-context-menu")},913:e=>{e.exports=require("electron-debug")},60:e=>{e.exports=require("vue-devtools")},17:e=>{e.exports=require("path")}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{s.r(a);var e=s(840),t=s(17),i=s.n(t);const o=require("child_process");var r=s.n(o);const n="sync-history",l="sync-profiles",d="sync-playlists",c="db-action-create",p="db-action-find",u="db-action-upsert",y="db-action-delete",h="db-action-delete-multiple",w="db-action-delete-all",f="db-action-persist",g="db-action-history-update-watch-progress",m="db-action-playlists-upsert-video-by-playlist-name",v="db-action-playlists-upsert-video-ids-by-playlist-id",b="db-action-playlists-delete-video-by-playlist-name",S="db-action-playlists-delete-video-ids",_="db-action-playlists-delete-all-videos",x="sync-create",P="sync-upsert",M="sync-delete",C="sync-delete-all",B="sync-history-update-watch-progress",I="sync-playlists-upsert-video",k="sync-playlists-delete-video",A=require("nedb-promises");var W,N,$=s.n(A);let D=null;if(null!==(W=process)&&void 0!==W&&null!==(N=W.versions)&&void 0!==N&&N.electron){const{app:e}=s(840),{join:t}=s(17),a=e.getPath("userData");D=e=>t(a,`${e}.db`)}else D=e=>`${e}.db`;const T={};T.settings=$().create({filename:D("settings"),autoload:!0}),T.profiles=$().create({filename:D("profiles"),autoload:!0}),T.playlists=$().create({filename:D("playlists"),autoload:!0}),T.history=$().create({filename:D("history"),autoload:!0});const O=T,E={settings:class{static find(){return O.settings.find({_id:{$ne:"bounds"}})}static upsert(e,t){return O.settings.update({_id:e},{_id:e,value:t},{upsert:!0})}static _findAppReadyRelatedSettings(){return O.settings.find({$or:[{_id:"disableSmoothScrolling"},{_id:"useProxy"},{_id:"proxyProtocol"},{_id:"proxyHostname"},{_id:"proxyPort"}]})}static _findBounds(){return O.settings.findOne({_id:"bounds"})}static _findTheme(){return O.settings.findOne({_id:"baseTheme"})}static _updateBounds(e){return O.settings.update({_id:"bounds"},{_id:"bounds",value:e},{upsert:!0})}},history:class{static find(){return O.history.find({}).sort({timeWatched:-1})}static upsert(e){return O.history.update({videoId:e.videoId},e,{upsert:!0})}static updateWatchProgress(e,t){return O.history.update({videoId:e},{$set:{watchProgress:t}},{upsert:!0})}static delete(e){return O.history.remove({videoId:e})}static deleteAll(){return O.history.remove({},{multi:!0})}static persist(){O.history.persistence.compactDatafile()}},profiles:class{static create(e){return O.profiles.insert(e)}static find(){return O.profiles.find({})}static upsert(e){return O.profiles.update({_id:e._id},e,{upsert:!0})}static delete(e){return O.profiles.remove({_id:e})}static persist(){O.profiles.persistence.compactDatafile()}},playlists:class{static create(e){return O.playlists.insert(e)}static find(){return O.playlists.find({})}static upsertVideoByPlaylistName(e,t){return O.playlists.update({playlistName:e},{$push:{videos:t}},{upsert:!0})}static upsertVideoIdsByPlaylistId(e,t){return O.playlists.update({_id:e},{$push:{videos:{$each:t}}},{upsert:!0})}static delete(e){return O.playlists.remove({_id:e,protected:{$ne:!0}})}static deleteVideoIdByPlaylistName(e,t){return O.playlists.update({playlistName:e},{$pull:{videos:{videoId:t}}},{upsert:!0})}static deleteVideoIdsByPlaylistName(e,t){return O.playlists.update({playlistName:e},{$pull:{videos:{$in:t}}},{upsert:!0})}static deleteAllVideosByPlaylistName(e){return O.playlists.update({playlistName:e},{$set:{videos:[]}},{upsert:!0})}static deleteMultiple(e){return O.playlists.remove({_id:{$in:e},protected:{$ne:!0}})}static deleteAll(){return O.playlists.remove({protected:{$ne:!0}})}}};process.argv.includes("--version")?(console.log(`v${e.app.getVersion()}`),e.app.exit()):function(){s(478)({showSearchWithGoogle:!1,showSaveImageAs:!0,showCopyImageAddress:!0,prepend:(e,t,s)=>[{label:"Show Video Statistics",visible:"video"===t.mediaType,click:()=>{s.webContents.send("showVideoStatistics")}}]}),process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";const t=process.argv.includes("--debug");let a,o;async function A({replaceMainWindow:t=!0,windowStartupUrl:s=null,showWindowNow:o=!1}={}){const r={backgroundColor:await E.settings._findTheme().then((({value:t})=>{switch(t){case"dark":return"#212121";case"light":return"#f1f1f1";case"black":return"#000000";case"dracula":return"#282a36";default:return e.nativeTheme.shouldUseDarkColors?"#212121":"#f1f1f1"}})).catch((t=>(console.log(t),e.nativeTheme.shouldUseDarkColors?"#212121":"#f1f1f1"))),darkTheme:e.nativeTheme.shouldUseDarkColors,icon:`${__dirname}/_icons/iconColor.png`,autoHideMenuBar:!0,webPreferences:{nodeIntegration:!0,nodeIntegrationInWorker:!1,webSecurity:!1,backgroundThrottling:!1,contextIsolation:!1}},n=new e.BrowserWindow(Object.assign({show:o},r));n.webContents.setWindowOpenHandler((e=>(A({replaceMainWindow:!1,showWindowNow:!0,windowStartupUrl:e.url}),{action:"deny"}))),t&&(a=n),n.setBounds({width:1200,height:800});const l=await E.settings._findBounds();if("object"==typeof(null==l?void 0:l.value)){const{maximized:t,...s}=l.value;e.screen.getAllDisplays().reduce(((e,{size:{width:t}})=>e+t),0)>=s.x&&n.setBounds({x:s.x,y:s.y,width:s.width,height:s.height}),t&&n.maximize()}t&&function(){const t=[{label:"File",submenu:[{role:"quit"}]},{label:"Edit",submenu:[{role:"cut"},{role:"copy",accelerator:"CmdOrCtrl+C",selector:"copy:"},{role:"paste",accelerator:"CmdOrCtrl+V",selector:"paste:"},{role:"pasteandmatchstyle"},{role:"delete"},{role:"selectall"}]},{label:"View",submenu:[{role:"reload"},{role:"forcereload",accelerator:"CmdOrCtrl+Shift+R"},{role:"toggledevtools"},{type:"separator"},{role:"resetzoom"},{role:"zoomin"},{role:"zoomout"},{type:"separator"},{role:"togglefullscreen"}]},{role:"window",submenu:[{role:"minimize"},{role:"close"}]}];"darwin"===process.platform&&(t.unshift({label:e.app.getName(),submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideothers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}),t.push({role:"window"},{role:"help"},{role:"services"}));const s=e.Menu.buildFromTemplate(t);e.Menu.setApplicationMenu(s)}(),null!=s?n.loadURL(s):n.loadFile(`${__dirname}/index.html`),global.__static=i().join(__dirname,"/static").replace(/\\/g,"\\\\"),n.once("ready-to-show",(()=>{n.isVisible()||(n.show(),n.focus())})),n.once("close",(async()=>{if(1!==e.BrowserWindow.getAllWindows().length)return;const t={...n.getNormalBounds(),maximized:n.isMaximized()};await E.settings._updateBounds(t)})),n.once("closed",(()=>{const t=e.BrowserWindow.getAllWindows();0!==t.length&&n===a&&(a=t[0]),console.log("closed")}))}function W(t,s,a){const i=e.BrowserWindow.getAllWindows().filter((e=>e.webContents.id!==s.sender.id));for(const e of i)e.webContents.send(t,a)}e.app.commandLine.appendSwitch("disable-features","OutOfBlinkCors"),e.app.commandLine.appendSwitch("enable-accelerated-video-decode"),e.app.commandLine.appendSwitch("enable-file-cookies"),e.app.commandLine.appendSwitch("ignore-gpu-blacklist"),e.app.removeAsDefaultProtocolClient("freetube"),e.app.setAsDefaultProtocolClient("freetube"),e.app.requestSingleInstanceLock()||e.app.quit(),e.app.on("second-instance",((e,t,s)=>{if(a&&void 0!==t){a.isMinimized()&&a.restore(),a.focus();const e=D(t);e&&a.webContents.send("openUrl",e)}})),e.app.on("ready",(async(s,i)=>{var o;let r;try{r=await E.settings._findAppReadyRelatedSettings()}catch(t){return console.error(t),void e.app.exit()}let n=!1,l=!1,d="socks5",c="127.0.0.1",p="9050";(null===(o=r)||void 0===o?void 0:o.length)>0&&r.forEach((e=>{switch(e._id){case"disableSmoothScrolling":n=e.value;break;case"useProxy":l=e.value;break;case"proxyProtocol":d=e.value;break;case"proxyHostname":c=e.value;break;case"proxyPort":p=e.value}})),n?e.app.commandLine.appendSwitch("disable-smooth-scrolling"):e.app.commandLine.appendSwitch("enable-smooth-scrolling"),l&&e.session.defaultSession.setProxy({proxyRules:`${d}://${c}:${p}`}),["http://www.youtube.com","https://www.youtube.com","http://youtube.com","https://youtube.com"].forEach((t=>{e.session.defaultSession.cookies.set({url:t,name:"CONSENT",value:"YES+",sameSite:"no_restriction"})})),await A(),t&&a.webContents.openDevTools()})),e.ipcMain.once("appReady",(()=>{o&&a.webContents.send("openUrl",o)})),e.ipcMain.once("relaunchRequest",(()=>{const{env:{APPIMAGE:t,PORTABLE_EXECUTABLE_FILE:s}}=process;t?r().spawn(t,{detached:!0,stdio:"ignore"}).unref():e.app.relaunch({args:process.argv.slice(1),execPath:s||process.execPath}),e.app.quit()})),e.nativeTheme.on("updated",(()=>{e.BrowserWindow.getAllWindows().forEach((t=>{t.webContents.send("native-theme-update",e.nativeTheme.shouldUseDarkColors)}))})),e.ipcMain.on("enable-proxy",((t,s)=>{console.log(s),e.session.defaultSession.setProxy({proxyRules:s})})),e.ipcMain.on("disable-proxy",(()=>{e.session.defaultSession.setProxy({})})),e.ipcMain.on("open-external-link",((t,s)=>{"string"==typeof s&&e.shell.openExternal(s)})),e.ipcMain.handle("get-system-locale",(()=>e.app.getLocale())),e.ipcMain.handle("get-user-data-path",(()=>e.app.getPath("userData"))),e.ipcMain.on("get-user-data-path-sync",(t=>{t.returnValue=e.app.getPath("userData")})),e.ipcMain.handle("get-pictures-path",(()=>e.app.getPath("pictures"))),e.ipcMain.handle("show-open-dialog",(async(t,s)=>await e.dialog.showOpenDialog(s))),e.ipcMain.handle("show-save-dialog",(async(t,{options:s,useModal:a})=>{if(a){const a=e.BrowserWindow.getAllWindows().find((e=>e.webContents.id===t.sender.id));if(a)return await e.dialog.showSaveDialog(a,s)}return await e.dialog.showSaveDialog(s)})),e.ipcMain.on("stop-power-save-blocker",((t,s)=>{e.powerSaveBlocker.stop(s)})),e.ipcMain.handle("start-power-save-blocker",(t=>e.powerSaveBlocker.start("prevent-display-sleep"))),e.ipcMain.on("create-new-window",((e,{windowStartupUrl:t=null}={})=>{A({replaceMainWindow:!1,showWindowNow:!0,windowStartupUrl:t})})),e.ipcMain.on("open-in-external-player",((e,t)=>{r().spawn(t.executable,t.args,{detached:!0,stdio:"ignore"}).unref()})),e.ipcMain.handle("db-settings",(async(e,{action:t,data:s})=>{try{switch(t){case p:return await E.settings.find();case u:return await E.settings.upsert(s._id,s.value),W("sync-settings",e,{event:P,data:s}),null;default:throw"invalid settings db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-history",(async(e,{action:t,data:s})=>{try{switch(t){case p:return await E.history.find();case u:return await E.history.upsert(s),W(n,e,{event:P,data:s}),null;case g:return await E.history.updateWatchProgress(s.videoId,s.watchProgress),W(n,e,{event:B,data:s}),null;case y:return await E.history.delete(s),W(n,e,{event:M,data:s}),null;case w:return await E.history.deleteAll(),W(n,e,{event:C}),null;case f:return E.history.persist(),null;default:throw"invalid history db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-profiles",(async(e,{action:t,data:s})=>{try{switch(t){case c:{const t=await E.profiles.create(s);return W(l,e,{event:x,data:t}),t}case p:return await E.profiles.find();case u:return await E.profiles.upsert(s),W(l,e,{event:P,data:s}),null;case y:return await E.profiles.delete(s),W(l,e,{event:M,data:s}),null;case f:return E.profiles.persist(),null;default:throw"invalid profile db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.ipcMain.handle("db-playlists",(async(e,{action:t,data:s})=>{try{switch(t){case c:return await E.playlists.create(s),null;case p:return await E.playlists.find();case m:return await E.playlists.upsertVideoByPlaylistName(s.playlistName,s.videoData),W(d,e,{event:I,data:s}),null;case v:return await E.playlists.upsertVideoIdsByPlaylistId(s._id,s.videoIds),null;case y:return await E.playlists.delete(s),null;case b:return await E.playlists.deleteVideoIdByPlaylistName(s.playlistName,s.videoId),W(d,e,{event:k,data:s}),null;case S:return await E.playlists.deleteVideoIdsByPlaylistName(s.playlistName,s.videoIds),null;case _:return await E.playlists.deleteAllVideosByPlaylistName(s),null;case h:return await E.playlists.deleteMultiple(s),null;case w:return await E.playlists.deleteAll(),null;default:throw"invalid playlist db action"}}catch(e){throw"string"==typeof e?e:e.toString()}})),e.app.once("window-all-closed",(()=>{e.session.defaultSession.clearCache(),e.session.defaultSession.clearStorageData({storages:["appcache","cookies","filesystem","indexdb","shadercache","websql","serviceworkers","cachestorage"]}),"darwin"!==process.platform&&e.app.quit()})),e.app.on("activate",(()=>{0===e.BrowserWindow.getAllWindows().length&&A()})),e.app.on("open-url",((e,t)=>{e.preventDefault(),a&&a.webContents?a.webContents.send("openUrl",$(t)):o=$(t)}));const N=D(process.argv);function $(e){return e.replace("freetube://","")}function D(e){return e.length>1?$(e[e.length-1]):null}N&&(o=N)}()})(),module.exports=a})();